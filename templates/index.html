{% extends "layout.html" %}
{% block content %}
  <section class="space-y-3">
    <div class="flex flex-col gap-4 md:flex-row md:items-center md:justify-between">
      <div class="relative w-full md:max-w-md">
        <label class="sr-only" for="searchItems">Search items</label>
        <input id="searchItems" type="search" name="search" placeholder="Search by name, location, or description" class="search-input w-full rounded-2xl border border-slate-200/80 bg-white px-4 py-3 ps-11 text-sm font-medium text-slate-700 shadow-sm outline-none transition placeholder:text-slate-400 focus:border-primary-300 focus:ring-4 focus:ring-primary-200/60" autocomplete="off" />
        <svg class="pointer-events-none absolute left-4 top-1/2 h-5 w-5 -translate-y-1/2 text-slate-400" viewBox="0 0 24 24" stroke-width="1.6" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
          <circle cx="11" cy="11" r="7" />
          <path d="m20 20-3-3" />
        </svg>
      </div>
      <div class="flex flex-wrap items-center gap-3">
        <div class="status-toggle" role="group" aria-label="Filter items by status">
          <button type="button" class="status-pill status-pill--active" data-status-filter="available" aria-pressed="true">Available</button>
          <button type="button" class="status-pill" data-status-filter="claimed" aria-pressed="false">Claimed</button>
        </div>
      </div>
    </div>

    {% if items and items|length > 0 %}
      <div id="itemsGrid" class="grid grid-cols-1 gap-6 pt-2 sm:grid-cols-2 xl:grid-cols-3">
        {% for item in items %}
          {% set status = (item['status'] or 'available')|lower %}
          <a href="{{ url_for('item_detail', item_id=item['id']) }}" class="item-card group" data-item data-name="{{ item['name'] or '' }}" data-location="{{ item['location'] or '' }}" data-description="{{ item['description'] or '' }}" data-status="{{ status }}">
            <span class="item-card__media">
              {% if item['image_filename'] %}
                <img src="{{ url_for('static', filename='uploads/' ~ item['image_filename']) }}" alt="{{ item['name'] }}" loading="lazy" />
              {% else %}
                <span class="item-card__placeholder">
                  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
                    <path d="M3 4v16h18" />
                    <path d="m3 14 6-6 4 4 5-5" />
                  </svg>
                  Awaiting image
                </span>
              {% endif %}
              <span class="status-badge {{ 'status-badge--available' if status == 'available' else 'status-badge--claimed' }}">
                <span class="status-dot"></span>
                {{ 'Available' if status == 'available' else 'Claimed' }}
              </span>
            </span>
            <span class="item-card__body">
              <span class="item-card__header">
                <span>
                  <span class="item-card__title">{{ item['name'] }}</span>
                  <span class="item-card__location">
                    <svg viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
                      <path fill-rule="evenodd" d="M10 2a6 6 0 0 0-6 6c0 4.418 6 10 6 10s6-5.582 6-10a6 6 0 0 0-6-6Zm0 8a2 2 0 1 1 0-4 2 2 0 0 1 0 4Z" clip-rule="evenodd" />
                    </svg>
                    {{ item['location'] or 'Location unknown' }}
                  </span>
                </span>
                <time class="item-card__date" datetime="{{ item['date_found'] or '' }}">{{ item['date_found'] or 'â€”' }}</time>
              </span>
              <span class="item-card__description line-clamp-3 {{ '' if item['description'] else 'item-card__description--muted' }}">
                {% if item['description'] %}
                  {{ item['description'] }}
                {% else %}
                  No additional description provided.
                {% endif %}
              </span>
            </span>
          </a>
        {% endfor %}
      </div>
    {% else %}
      <div class="mx-auto max-w-2xl rounded-3xl border border-dashed border-slate-300/80 bg-white/70 p-10 text-center shadow-sm">
        <svg class="mx-auto h-12 w-12 text-slate-400" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
          <path d="M3 14s1-3 9-3 9 3 9 3" />
          <path d="M7 10a5 5 0 1 1 10 0" />
          <path d="M12 19h.01" />
        </svg>
        <h2 class="mt-4 text-2xl font-semibold text-slate-900">No items available</h2>
        <p class="mt-3 text-sm text-slate-500">Help your classmates by submitting the first lost item report!</p>
      </div>
    {% endif %}
  </section>
{% endblock %}
